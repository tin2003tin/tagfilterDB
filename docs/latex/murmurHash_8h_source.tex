\doxysection{murmur\+Hash.\+h}
\hypertarget{murmurHash_8h_source}{}\label{murmurHash_8h_source}\index{include/tagfilterdb/murmurHash.h@{include/tagfilterdb/murmurHash.h}}
\mbox{\hyperlink{murmurHash_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ TAGFILTERDB\_MURMURHASH\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ TAGFILTERDB\_MURMURHASH\_H}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{comment}{//\ A\ variation\ of\ the\ MurmurHash3\ implementation}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ (https://github.com/aappleby/smhasher/blob/master/src/MurmurHash3.cpp)\ Here}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ we\ unrolled\ the\ loop\ used\ there\ into\ individual\ calls\ to\ update(),\ as\ we}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ usually\ hash\ object\ fields\ instead\ of\ entire\ buffers.}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{comment}{//\ Platform-\/specific\ functions\ and\ macros}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Microsoft\ Visual\ Studio}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <cstdint>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetagfilterdb_1_1support}{tagfilterdb::support}}\ \{}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00021\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacetagfilterdb_1_1support_ab77f12134ec5cbc8a47fbf93fff54ba7}{Encode32}}(\textcolor{keywordtype}{char}\ *p\_dst,\ uint32\_t\ a\_v)\ \{}
\DoxyCodeLine{00022\ \ \ \ \ uint8\_t\ *\textcolor{keyword}{const}\ p\_buffer\ =\ \textcolor{keyword}{reinterpret\_cast<}uint8\_t\ *\textcolor{keyword}{>}(p\_dst);}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \ \ \ \ p\_buffer[0]\ =\ \textcolor{keyword}{static\_cast<}uint8\_t\textcolor{keyword}{>}(a\_v);}
\DoxyCodeLine{00025\ \ \ \ \ p\_buffer[1]\ =\ \textcolor{keyword}{static\_cast<}uint8\_t\textcolor{keyword}{>}(a\_v\ >>\ 8);}
\DoxyCodeLine{00026\ \ \ \ \ p\_buffer[2]\ =\ \textcolor{keyword}{static\_cast<}uint8\_t\textcolor{keyword}{>}(a\_v\ >>\ 16);}
\DoxyCodeLine{00027\ \ \ \ \ p\_buffer[3]\ =\ \textcolor{keyword}{static\_cast<}uint8\_t\textcolor{keyword}{>}(a\_v\ >>\ 24);}
\DoxyCodeLine{00028\ \}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{inline}\ uint32\_t\ \mbox{\hyperlink{namespacetagfilterdb_1_1support_a2684d31d7bfa5a01aaf4148c1ee90a89}{Decode32}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *p)\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t\ *\textcolor{keyword}{const}\ p\_buffer\ =\ \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const\ }uint8\_t\ *\textcolor{keyword}{>}(p);}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}uint32\_t\textcolor{keyword}{>}(p\_buffer[0])\ |}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keyword}{static\_cast<}uint32\_t\textcolor{keyword}{>}(p\_buffer[1])\ <<\ 8)\ |}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keyword}{static\_cast<}uint32\_t\textcolor{keyword}{>}(p\_buffer[2])\ <<\ 16)\ |}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keyword}{static\_cast<}uint32\_t\textcolor{keyword}{>}(p\_buffer[3])\ <<\ 24);}
\DoxyCodeLine{00040\ \}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00045\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacetagfilterdb_1_1support_aa8700b4ce44ecd45f122cf73f613a31e}{AppendEncode32}}(std::string\ *p\_dst,\ uint32\_t\ a\_v)\ \{}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordtype}{char}\ t\_buf[\textcolor{keyword}{sizeof}(a\_v)];}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{namespacetagfilterdb_1_1support_ab77f12134ec5cbc8a47fbf93fff54ba7}{Encode32}}(t\_buf,\ a\_v);}
\DoxyCodeLine{00048\ \ \ \ \ p\_dst-\/>append(t\_buf,\ \textcolor{keyword}{sizeof}(t\_buf));}
\DoxyCodeLine{00049\ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \textcolor{preprocessor}{\#define\ HASH\_VERSION\ X32}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtagfilterdb_1_1support_1_1MurmurHash}{MurmurHash}}\ \{}
\DoxyCodeLine{00054\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keyword}{static}\ uint32\_t\ \mbox{\hyperlink{classtagfilterdb_1_1support_1_1MurmurHash_ac9777ca287c2da31c82b1eab316c4c66}{Hash}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *data,\ \textcolor{keywordtype}{size\_t}\ n,\ uint32\_t\ seed);}
\DoxyCodeLine{00061\ \};}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \textcolor{preprocessor}{\#ifndef\ FALLTHROUGH\_INTENDED}}
\DoxyCodeLine{00064\ \textcolor{preprocessor}{\#define\ FALLTHROUGH\_INTENDED\ do\ \{\}\ while\ (0)}}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \textcolor{preprocessor}{\#if\ HASH\_VERSION\ ==\ X32}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00074\ \textcolor{keyword}{inline}\ uint32\_t\ \mbox{\hyperlink{classtagfilterdb_1_1support_1_1MurmurHash_ac9777ca287c2da31c82b1eab316c4c66}{MurmurHash::Hash}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *data,\ \textcolor{keywordtype}{size\_t}\ n,\ uint32\_t\ seed)\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keyword}{const}\ uint32\_t\ m\ =\ 0xc6a4a793;}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keyword}{const}\ uint32\_t\ r\ =\ 24;}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *limit\ =\ data\ +\ n;}
\DoxyCodeLine{00078\ \ \ \ \ uint32\_t\ h\ =\ seed\ \string^\ (n\ *\ m);}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{comment}{//\ Process\ 4\ bytes\ at\ a\ time}}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordflow}{while}\ (data\ +\ 4\ <=\ limit)\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ uint32\_t\ w\ =\ \mbox{\hyperlink{namespacetagfilterdb_1_1support_a2684d31d7bfa5a01aaf4148c1ee90a89}{Decode32}}(data);}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ data\ +=\ 4;}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ h\ +=\ w;}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ h\ *=\ m;}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ h\ \string^=\ (h\ >>\ 16);}
\DoxyCodeLine{00087\ \ \ \ \ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{comment}{//\ Handle\ remaining\ bytes}}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordflow}{switch}\ (limit\ -\/\ data)\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordflow}{case}\ 3:}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ h\ +=\ \textcolor{keyword}{static\_cast<}uint8\_t\textcolor{keyword}{>}(data[2])\ <<\ 16;}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{murmurHash_8h_adbc889df74eb0efe177d0dcde1541a24}{FALLTHROUGH\_INTENDED}};}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ h\ +=\ \textcolor{keyword}{static\_cast<}uint8\_t\textcolor{keyword}{>}(data[1])\ <<\ 8;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{murmurHash_8h_adbc889df74eb0efe177d0dcde1541a24}{FALLTHROUGH\_INTENDED}};}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ h\ +=\ \textcolor{keyword}{static\_cast<}uint8\_t\textcolor{keyword}{>}(data[0]);}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ h\ *=\ m;}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ h\ \string^=\ (h\ >>\ r);}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00102\ \ \ \ \ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keywordflow}{return}\ h;}
\DoxyCodeLine{00105\ \}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00108\ \textcolor{preprocessor}{\#error\ "{}Expected\ sizeof(size\_t)\ to\ be\ 4\ or\ 8."{}}}
\DoxyCodeLine{00109\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \}\ \textcolor{comment}{//\ namespace\ tagfilterdb::support}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
